# Библиотека easyTimer

Библиотека представляет собой набор макросов
для простого использования таймеров.

---

### Система подсказок
Например, если хотим использовать таймер 0, вводим **`T0`**
Наводим курсор и получаем список доступных опций.
Затем также можно посмотреть справку по каждой опции.

---

## Текущее состояние

### **ATmega328P**
#### <span style="color:green">Реализовано</span>

+ **<span style="color:blue">Таймер 0</span>**
  + **T0_[ STOP, EXT_FALL, EXT_RISE ]** Отключение таймера, внешние тактирование
  + **T0_DIV_[ 1, 8, 64, 256, 1024 ]** Предварительный делитель (включает таймер)
  + **T0_[ NORMAL, CTC, FAST_PWM [ _CUSTOM ], PHASE_PWM [ _CUSTOM ] ]** Режимы таймера: счётчик, шим
  + **T0_OC0[ A, B ] _ [ OFF, ON, PVM[ _INV ] ]** Режимы выводов: вкл, выкл, шим
  + **T0_[ OVF, COMPA, COMPB ] _ [ ON, OFF ]** Установка прерываний
+ **<span style="color:blue">Таймер 1</span>**
  + **T1_[ STOP, EXT_FALL, EXT_RISE ]** Отключение таймера, внешние тактирование
  + **T1_DIV_[ 1, 8, 64, 256, 1024 ]** Предварительный делитель (включает таймер)
  + **T1_[ NORMAL, CTC, FAST_PWM_ [8, 9, 10, CUSTOM ], PHASE_PWM_ [ 8, 9, 10, CUSTOM ] ]** Режимы таймера: счётчик, шим
  + **T1_OC1[ A, B ] _ [ OFF, ON, PVM [ _INV ] ]** Режимы выводов: вкл, выкл, шим
  + **T1_[ OVF, COMPA, COMPB ] _ [ ON, OFF ]** Установка прерываний
+ **<span style="color:blue">Таймер 2</span>**
  + **T2_[ STOP, EXT_FALL, EXT_RISE ]** Отключение таймера, внешние тактирование
  + **T2_DIV_[ 1, 8, 32, 64, 128, 256, 1024 ]** Предварительный делитель (включает таймер)
  + **T2_[ NORMAL, CTC, FAST_PWM [ _CUSTOM ], PHASE_PWM [ _CUSTOM ] ]** Режимы таймера: счётчик, шим
  + **T2_OC2[ A, B ] _ [ OFF, ON, PVM [ _INV ] ]** Режимы выводов: вкл, выкл, шим
  + **T2_[ OVF, COMPA, COMPB ] _ [ ON, OFF ]** Установка прерываний


#### <span style="color:red">Запланировано</span>

+ **<span style="color:blue">Таймер 1</span>**
  + **T1_[ FAST_PWM_CUSTOM, PHASE_PWM_CUSTOM ]** 2 варианта top: ICR1 OCR1A
  + **T1_CAPT_ [ ON, OFF ]** Установка прерывания захвата
+ **<span style="color:blue">Таймер 2</span>**
  + Асинхронный режим с 32 MHz
+ **<span style="color:blue">Сторожевой таймер</span>**
  + Включение / выключения
  + Прерывание
  + Ресет
  + Сброс

---

### **ATmega128**
#### <span style="color:green">Реализовано</span>

+ **<span style="color:blue">Таймер 0</span>**
  + **T0_STOP** Отключение таймера
  + **T0_DIV_[ 1, 8, 32, 64, 128, 256, 1024 ]** Предварительный делитель (включает таймер)
  + **T0_[ NORMAL, CTC, FAST_PWM, PHASE_PWM ]** Режимы таймера: счётчик, шим
  + **T0_OC0_[ OFF, ON, PVM [ _INV ]** Режимы выводов: вкл, выкл, шим
  + **T0_[ OVF, COMP ] _ [ ON, OFF ]** Установка прерываний
+ **<span style="color:blue">Таймер 1</span>**
  + **T1_[ STOP, EXT_FALL, EXT_RISE ]** Отключение таймера, внешние тактирование
  + **T1_DIV_[ 1, 8, 64, 256, 1024 ]** Предварительный делитель (включает таймер)
  + **T1_[ NORMAL, CTC, FAST_PWM_ [ 8, 9, 10, CUSTOM ], PHASE_PWM_ [8, 9, 10, CUSTOM ] ]** Режимы таймера: счётчик, шим
  + **T1_OC1[A, B ] _ [ OFF, ON, PVM [ _INV ] ]** Режимы выводов: вкл, выкл, шим
  + **T1_[ OVF, CAPT, COMPA, COMPB, COMPC ] _ [ ON, OFF ]** Установка прерываний
+ **<span style="color:blue">Таймер 3</span>**
  + **T3_[ STOP, EXT_FALL, EXT_RISE ]** Отключение таймера, внешние тактирование
  + **T3_DIV_[ 1, 8, 64, 256, 1024 ]** Предварительный делитель (включает таймер)
  + **T3_[ NORMAL, CTC, FAST_PWM_ [ 8, 9, 10, CUSTOM ], PHASE_PWM_[ 8, 9, 10, CUSTOM ] ]** Режимы таймера: счётчик, шим
  + **T3_OC1[ A, B ] _ [ OFF, ON, PVM[ _INV ] ]** Режимы выводов: вкл, выкл, шим
  + **T3_[ OVF, CAPT, COMPA, COMPB, COMPC ] _ [ ON, OFF ]** Установка прерываний

#### <span style="color:red">Запланировано</span>

+ Таймер 2.
+ Сторожевой таймер.
+ Некоторые режимы для таймеров 1 и 3.

---

## Использование

Пример кода, который будет работать на обеих микроконтроллерах:

```c+
#include "timer.h"
int main()
{
  T0_DIV_1024; // Подключить таймер 0, через пред-делитель f = F_CPU / 1024
  T0_CTC;      // Режим сравнения с регистром OCR0x

#ifdef __AVR_ATmega328P__
  OCR0A = F_CPU / 1024 / 100 - 1; // f = 100 Hz
  T0_COMPA_ON; // Включить прерывание при сравнении с OCR0A
#elif __AVR_ATmega128__
  OCR0 = F_CPU / 1024 / 100 - 1; // 100 Hz
  T0_COMP_ON; // Включить прерывание при сравнении с OCR0
}

#ifdef __AVR_ATmega328P__
ISR(TIMER0_COMPA_vect) // Прерывание при сравнении с OCR0A

#elif __AVR_ATmega128__
ISR(TIMER0_COMP_vect) // Прерывание при сравнении с OCR0
#endif

{
   // Код прерывания, вызываемого 100 раз в секунду
}

```
